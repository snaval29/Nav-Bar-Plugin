<!DOCTYPE html>
<html>
<head>
<style>
  /* (Keep your existing CSS styles here - they were good!) */
  :root { --primary: #2C6CFF; --bg: #F8F9FC; --surface: #FFFFFF; --border: #E5E8EB; --text: #1F2937; }
  body { font-family: 'Inter', sans-serif; padding: 0; margin: 0; background-color: var(--bg); color: var(--text); }
  .header { background: var(--surface); padding: 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
  .container { padding: 0 20px 80px 20px; }
  .row { display: flex; gap: 12px; margin-bottom: 16px; }
  .col { flex: 1; }
  label { display: block; margin-bottom: 6px; font-size: 11px; font-weight: 600; color: #6B7280; text-transform: uppercase; }
  select, input { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 13px; outline: none; box-sizing: border-box; }
  .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px; }
  .theme-card { background: var(--surface); border: 2px solid var(--border); border-radius: 12px; padding: 12px; cursor: pointer; text-align: center; }
  .theme-card.selected { border-color: var(--primary); background: #EFF6FF; }
  .preview-box { height: 32px; width: 100%; border-radius: 6px; margin-bottom: 8px; }
  .p-minimal { background: #fff; border: 1px solid #eee; }
  .p-glass { background: linear-gradient(135deg, #E0F2FE 0%, #F0F9FF 100%); border: 1px solid #fff; }
  .p-neo { background: #FEF08A; border: 2px solid #000; box-shadow: 2px 2px 0 #000; border-radius: 0; }
  .p-dark { background: #1F2937; border: 1px solid #374151; }
  .card-label { font-size: 12px; font-weight: 600; }
  .footer { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); padding: 16px 20px; border-top: 1px solid var(--border); }
  button { background: var(--primary); color: white; border: none; padding: 12px; font-weight: 600; width: 100%; border-radius: 8px; cursor: pointer; }
  button:disabled { background: #ccc; cursor: wait; }
</style>
</head>
<body>

  <div class="header">
    <h2>Nav Architect Pro</h2>
    <p>Powered by Iconify API</p>
  </div>

  <div class="container">
    <div class="row">
      <div class="col">
        <label>Nav Type</label>
        <select id="navType">
          <option value="mobile">Mobile (Bottom)</option>
          <option value="web">Website (Top)</option>
        </select>
      </div>
      <div class="col">
        <label>Typography</label>
        <select id="fontFamily">
          <option value="Inter">Inter</option>
          <option value="Roboto">Roboto</option>
          <option value="Poppins">Poppins</option>
          <option value="Lato">Lato</option>
          <option value="Montserrat">Montserrat</option>
          <option value="Oswald">Oswald</option>
          <option value="Playfair Display">Playfair Display</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col"><label>Width</label><input type="number" id="width" value="390"></div>
      <div class="col"><label>Height</label><input type="number" id="height" value="84"></div>
      <div class="col"><label>Radius</label><input type="number" id="radius" value="24"></div>
    </div>

    <label>Menu Items</label>
    <input type="text" id="sections" value="Home, Search, Notifications, Profile" placeholder="e.g. Home, Camera, Wifi, Settings">

    <label>Select Theme</label>
    <div class="theme-grid">
      <div class="theme-card selected" onclick="selectTheme('minimal', this)">
        <div class="preview-box p-minimal"></div><div class="card-label">Minimal</div>
      </div>
      <div class="theme-card" onclick="selectTheme('glass', this)">
        <div class="preview-box p-glass"></div><div class="card-label">Apple Glass</div>
      </div>
      <div class="theme-card" onclick="selectTheme('neobrutal', this)">
        <div class="preview-box p-neo"></div><div class="card-label">Neo-Brutal</div>
      </div>
      <div class="theme-card" onclick="selectTheme('dark', this)">
        <div class="preview-box p-dark"></div><div class="card-label">Dark Mode</div>
      </div>
    </div>
  </div>

  <div class="footer">
    <button id="create">Generate Component</button>
  </div>

  <script>
    let selectedTheme = 'minimal';
    function selectTheme(theme, el) {
      selectedTheme = theme;
      document.querySelectorAll('.theme-card').forEach(e => e.classList.remove('selected'));
      el.classList.add('selected');
      const r = document.getElementById('radius');
      if(theme === 'neobrutal') r.value = 0;
      else if(theme === 'glass') r.value = 32;
      else r.value = 24;
    }

    // --- NEW: FETCH ICONS FROM WEB ---
    async function fetchIconSvg(keyword) {
      // Clean keyword (e.g., "My Profile" -> "account")
      let term = keyword.toLowerCase().trim().split(' ').pop();
      // Map common terms to Material Design names
      const map = { profile: 'account', settings: 'cog', cart: 'cart', search: 'magnify', home: 'home', like: 'heart' };
      if (map[term]) term = map[term];

      try {
        // Fetch from Iconify (Material Design Icons)
        const response = await fetch(`https://api.iconify.design/mdi/${term}.svg`);
        if (!response.ok) return null;
        return await response.text();
      } catch (e) {
        return null;
      }
    }

    document.getElementById('create').onclick = async () => {
      const btn = document.getElementById('create');
      btn.innerText = "Fetching Icons...";
      btn.disabled = true;

      const navType = document.getElementById('navType').value;
      const fontFamily = document.getElementById('fontFamily').value;
      const width = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const radius = document.getElementById('radius').value;
      const sections = document.getElementById('sections').value.split(',');
      const styleSelect = selectedTheme;

      // Prepare data with fetched icons
      const itemsData = [];
      
      for (let section of sections) {
        const name = section.trim();
        const svgContent = await fetchIconSvg(name);
        itemsData.push({ name, svg: svgContent });
      }

      // Send EVERYTHING to code.ts
      parent.postMessage({ 
        pluginMessage: { 
          type: 'create-navbar', 
          navType, fontFamily, width, height, radius, styleSelect,
          itemsData // We send the full SVG strings now!
        } 
      }, '*');

      btn.innerText = "Generate Component";
      btn.disabled = false;
    }
  </script>
</body>
</html>